var t={};t="*{box-sizing:border-box;margin:0;padding:0}:host{pointer-events:none;display:block;position:absolute}canvas{display:block}";class e extends HTMLElement{static get observedAttributes(){return["top","left"]}set config(t){this._config=t,this.onConfigUpdate()}get config(){if(!this._config)throw Error("[CalendarDoor] config object not set");return this._config}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=`
      <style>${t}</style>
      <canvas></canvas>
    `,this.$canvas=this.shadowRoot.querySelector("canvas"),this.ctx=this.$canvas.getContext("2d")}onTick=t=>{try{this.renderFrame(this.config.sequence[t])}catch(t){console.error("Error rendering animation frame:",t)}};async onConfigUpdate(){this.style.top=`${this.config.position.top}px`,this.style.left=`${this.config.position.left}px`,this.style.width=`${this.config.size.width}px`,this.style.height=`${this.config.size.height}px`,this.$canvas.width=this.config.size.width,this.$canvas.height=this.config.size.height,this.renderFrame(0)}renderFrame(t){let e=this.config.images[t];e&&(this.ctx.clearRect(0,0,this.$canvas.width,this.$canvas.height),this.ctx.drawImage(e,0,0,this.$canvas.width,this.$canvas.height))}}customElements.define("animation-sequence",e);var i={};i="*{box-sizing:border-box;margin:0;padding:0}:host{cursor:pointer;z-index:6;will-change:transform;background-color:#fff;border-radius:50%;width:48px;height:48px;transition:transform .12s,box-shadow .12s;display:block;box-shadow:0 2px 6px #0000004d}.img-wrapper{pointer-events:none;justify-content:center;align-items:center;width:100%;height:100%;display:flex}img{pointer-events:none;width:60%;height:60%;display:block}";class s extends HTMLElement{static get observedAttributes(){return["on","off"]}attributeChangedCallback(t,e,i){"on"===t&&null!==i?this.hasAttribute("off")&&this.removeAttribute("off"):"off"===t&&null!==i&&this.hasAttribute("on")&&this.removeAttribute("on"),this.hasAttribute("on")||this.hasAttribute("off")||this.setAttribute("off",""),this.updateIcon()}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=`
      <style>${i}</style>
      <div class="img-wrapper"><img /></div>
    `,this.$icon=this.shadowRoot.querySelector("img"),this.updateIcon(),this.addEventListener("click",this.toggle)}get on(){return this.hasAttribute("on")}set on(t){t?(this.setAttribute("on",""),this.removeAttribute("off")):(this.setAttribute("off",""),this.removeAttribute("on")),this.updateIcon()}toggle=()=>{this.on=!this.on,this.on?this.dispatchUnmute():this.dispatchMute()};dispatchMute(){let t=new CustomEvent("audio-mute",{bubbles:!0,composed:!0});this.dispatchEvent(t)}dispatchUnmute(){let t=new CustomEvent("audio-unmute",{bubbles:!0,composed:!0});this.dispatchEvent(t)}updateIcon(){let t=this.hasAttribute("on");this.$icon.src=`images/${t?"ui/volume.svg":"ui/volume-slash.svg"}`,this.$icon.alt=t?"Sound On":"Sound Off"}}customElements.define("audio-toggle",s);var n={};n=":host{--width:5px;--edge-opacity:.7;pointer-events:none;z-index:2;background:linear-gradient(to bottom,rgba(0,0,0,var(--edge-opacity)),#0000 var(--width),#0000 calc(100% - var(--width)),rgba(0,0,0,var(--edge-opacity))),linear-gradient(to right,rgba(0,0,0,var(--edge-opacity)),#0000 var(--width),#0000 calc(100% - var(--width)),rgba(0,0,0,var(--edge-opacity)));background-blend-mode:lighten;width:100%;height:100%;display:block;position:absolute;top:0;left:0}";class a extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=`
      <style>${n}</style>
    `}}customElements.define("blur-overlay",a);var r={};r='*{box-sizing:border-box;margin:0;padding:0}:host{z-index:5;width:100%;height:100%;display:block;position:absolute}.open{pointer-events:none}main{width:100%;height:100%;position:relative}.door-frame{cursor:pointer;user-select:none;-webkit-user-drag:none;background-position:50%;background-repeat:no-repeat;border:5px dashed #333;border-radius:3px;justify-content:center;align-items:center;width:100%;height:100%;transition:transform 1.2s ease-out;display:flex;position:absolute;top:0;left:0}.label-container{aspect-ratio:1;justify-content:center;align-items:center;display:flex;& .label-text{width:52px;height:52px}}.content-wrapper{background-color:#222;border:1px solid #555;border-radius:2px;width:100%;height:100%;padding:8px;position:absolute;top:0;left:0;& .door-content{cursor:pointer;-webkit-user-drag:none;background-position:50%;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;justify-content:center;align-items:center;width:100%;height:100%;transition:background-size .9s ease-out;display:flex;box-shadow:inset -2px 2px 3px #0000004d;&:hover{background-size:106% 106%}}}.door-backdrop{background-color:#fff;border-radius:3px;width:100%;height:100%;position:absolute;top:0;left:0}.play-icon{cursor:pointer;background-color:#0006;border:none;border-radius:50%;width:30px;height:30px}.play-icon:before{content:"";border-top:9px solid #0000;border-bottom:9px solid #0000;border-left:14px solid #ffffffb3;width:0;height:0;position:absolute;top:50%;left:50%;transform:translate(-34%,-50%)}.hide{display:none}.shake{animation:.5s shake}@keyframes shake{0%{transform:translate(0)}20%{transform:translate(-3px)}40%{transform:translate(3px)}60%{transform:translate(-1px)}80%{transform:translate(1px)}to{transform:translate(0)}}';let o=document.createElement("template");o.innerHTML=`
  <style>${r}</style>

  <main>
    <div part="door-backdrop" class="door-backdrop">
      <loading-spinner></loading-spinner>
    </div>

    <div class="content-wrapper">
      <div id="door-content" class="door-content">
        <div id="play-icon" class="play-icon hide" tabindex="0" role="button" aria-label="Play">
        </div>
      </div>
    </div>

    <div id="door-frame" class="door-frame">
      <div class="label-container" part="label-container">
        <div id="label-text" class="label-text"></div>
      </div>
    </div>
  </main>
`;class l extends HTMLElement{static get observedAttributes(){return["preload"]}set config(t){this._config=t,this.update()}get config(){if(!this._config)throw Error("[CalendarDoor] config object not set");return this._config}set packageConfig(t){this._packageConfig=t,this.updatePackage()}get packageConfig(){if(!this._packageConfig)throw Error("[CalendarDoor] packageConfig object not set");return this._packageConfig}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(o.content.cloneNode(!0)),this.$doorFrame=this.shadowRoot.querySelector("#door-frame"),this.$doorLabel=this.shadowRoot.querySelector("#label-text"),this.$doorContent=this.shadowRoot.querySelector("#door-content")}connectedCallback(){this.dataset.interactive="",this.dataset.door="",this.update()}attributeChangedCallback(t,e,i){if("open"===t&&null!==i)return this.openDoor();this.update()}update(){this.id=this.config.id;let{top:t,left:e}=this.config.position||{},{width:i,height:s}=this.config.size||{};this.style.width=`${i}px`,this.style.height=`${s}px`,this.style.top=`${t}px`,this.style.left=`${e}px`;let n=`images/${this.config.filename}`,a=`images/door-numbers/${this.config.label}.webp`;this.$doorFrame.style.backgroundImage=`url(${n})`,this.$doorLabel.style.backgroundImage=`url(${a})`}updatePackage(){let t=this.packageConfig.thumbnail;this.$doorContent.style.backgroundImage=`url('images/${t}')`,this.$doorContent.querySelector("#play-icon").classList.remove("hide")}openIfAllowed(){this.mayOpen()&&this.open()}mayOpen(){return(t=>{let e=new Date;if(e.getFullYear()>2025)return!0;let i=e.getDate(),s=parseInt(t,10);return!isNaN(s)&&s<=i})(this.config.label)}shake(){this.$doorFrame.classList.remove("shake"),this.offsetWidth,this.$doorFrame.classList.add("shake")}open(){let t=this.config.size.width,e="left"===(this.config.direction||"left")?`-${t-2}px`:`${t-2}px`;this.$doorFrame.style.transform=`translateX(${e})`,this.$doorFrame.classList.add("open"),this.removeAttribute("data-door"),this.setAttribute("open","true"),this.dataset.content=""}displayContent(){this.dispatchEvent(new CustomEvent("show-player",{bubbles:!0,composed:!0,detail:{src:this.packageConfig.src}}))}}customElements.define("calendar-door",l);var h={};h="*{box-sizing:border-box;margin:0;padding:0}:host{cursor:pointer;z-index:6;will-change:transform;background-color:#fff;border-radius:50%;width:48px;height:48px;transition:transform .12s,box-shadow .12s;display:block;box-shadow:0 2px 6px #0000004d}.img-wrapper{pointer-events:none;justify-content:center;align-items:center;width:100%;height:100%;display:flex}img{pointer-events:none;width:60%;height:60%;display:block}";class c extends HTMLElement{static get observedAttributes(){return["fullscreen","windowed"]}attributeChangedCallback(t,e,i){"fullscreen"===t&&null!==i?this.hasAttribute("windowed")&&this.removeAttribute("windowed"):"windowed"===t&&null!==i&&this.hasAttribute("fullscreen")&&this.removeAttribute("fullscreen"),this.hasAttribute("fullscreen")||this.hasAttribute("windowed")||this.setAttribute("windowed",""),this.updateIcon()}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=`
      <style>${h}</style>
      <div class="img-wrapper"><img /></div>
    `,this.$icon=this.shadowRoot.querySelector("img"),this.updateIcon(),this.addEventListener("click",this.toggle)}get fullscreen(){return this.hasAttribute("fullscreen")}set fullscreen(t){t?(this.setAttribute("fullscreen",""),this.removeAttribute("windowed")):(this.setAttribute("windowed",""),this.removeAttribute("fullscreen")),this.updateIcon()}toggle=()=>{this.fullscreen=!this.fullscreen,this.fullscreen?this.dispatchEnterFullScreen():this.dispatchExitFullScreen()};dispatchEnterFullScreen(){let t=new CustomEvent("enter-fullscreen",{bubbles:!0,composed:!0});this.dispatchEvent(t)}dispatchExitFullScreen(){let t=new CustomEvent("exit-fullscreen",{bubbles:!0,composed:!0});this.dispatchEvent(t)}updateIcon(){this.fullscreen?(this.$icon.src="images/ui/minimize.svg",this.$icon.alt="Exit full-screen"):(this.$icon.src="images/ui/maximize.svg",this.$icon.alt="Enter full-screen")}}customElements.define("fullscreen-toggle",c);var d={};d=":host{--spinner-width:3px;--spinner-size:30px;--spinner-color:#555;--spinner-background-color:#f3f3f3;width:100%;height:100%;display:block;position:relative}.spinner{width:var(--spinner-size);height:var(--spinner-size);border:var(--spinner-width)solid var(--spinner-background-color);border-top:var(--spinner-width)solid var(--spinner-color);border-radius:50%;animation:2.5s linear infinite spin;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}@keyframes spin{0%{transform:translate(-50%,-50%)rotate(0)}to{transform:translate(-50%,-50%)rotate(360deg)}}";class u extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=`
      <style>${d}</style>

      <div class="spinner" part="spinner"></div>
    `}}customElements.define("loading-spinner",u);var p={};p="*{box-sizing:border-box;margin:0;padding:0}:host{z-index:10;display:block;position:absolute;inset:0}.overlay{background-color:#000000d9;justify-content:center;align-items:center;width:100%;height:100%;display:flex;& iframe{aspect-ratio:16/9;border:none;width:95%;max-width:560px;max-height:315px}}.close-button{color:#fff;text-align:center;cursor:pointer;z-index:11;background-color:#00000080;border:none;border-radius:15px;width:35px;height:35px;font-size:20px;line-height:30px;position:absolute;top:10px;right:10px}";let g=document.createElement("template");g.innerHTML=`
  <style>${p}</style>

  <div part="overlay" class="overlay"></div>
  <button part="close-button" class="close-button" aria-label="Close">
    &times;
  </button>
`;class m extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(g.content.cloneNode(!0)),this.$overlay=this.shadowRoot.querySelector('[part="overlay"]'),this.$closeButton=this.shadowRoot.querySelector('[part="close-button"]')}connectedCallback(){this.classList.add("hide"),this.$overlay.addEventListener("click",this.close),this.$closeButton.addEventListener("click",this.close)}disconnectedCallback(){this.$overlay.removeEventListener("click",this.close),this.$closeButton.removeEventListener("click",this.close)}displayImage(t){let{src:e}=t.detail;this.$overlay.innerHTML=`
    <iframe
      src="${e}&autoplay=1&rel=0"
      frameborder="0"
      allow="autoplay; clipboard-write; encrypted-media; picture-in-picture"
      referrerpolicy="strict-origin-when-cross-origin"
      allowfullscreen
    ></iframe>
    `,this.classList.remove("hide")}close=t=>{"IMG"!==t.target.tagName&&(this.classList.add("hide"),this.$overlay.innerHTML="",this.dispatchEvent(new CustomEvent("player-closed",{bubbles:!0,composed:!0})))}}customElements.define("media-player",m);var f={};f=":host{contain:content;--padding:0px;--background-color:transparent;display:block}.viewport,.viewport *{box-sizing:border-box;margin:0;padding:0}.viewport{user-select:none;cursor:default;touch-action:none;width:100%;height:100%;position:relative;overflow:auto;&:active{cursor:grabbing}}.content-area{will-change:transform;padding:var(--padding);background-color:var(--background-color);position:absolute;top:0;left:0}.hide-scrollbars{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;&::-webkit-scrollbar{display:none}}";let b=document.createElement("template");b.innerHTML=`
  <style>${f}</style>

  <div class="viewport hide-scrollbars" tabindex="0" role="group" aria-label="Pannable content">
    <div class="content-area">
      <slot></slot>
    </div>
  </div>
`;class v extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(b.content.cloneNode(!0)),this.$viewport=this.shadowRoot.querySelector(".viewport"),this.$contentArea=this.shadowRoot.querySelector(".content-area"),this.currentX=0,this.currentY=0,this._dragging=!1,this._maybeDragging=!1,this._startClientX=0,this._startClientY=0,this._startX=0,this._startY=0,this._maxX=0,this._maxY=0,this._rafId=null,this._frameRequested=!1,this._pendingX=0,this._pendingY=0,this._ro=null,this._dragThreshold=6,this._activePointerId=null,this._suppressNextClick=!1,this._lastMoveTime=0,this._lastX=0,this._lastY=0,this._velocityX=0,this._velocityY=0,this._maxVelocityX=.8,this._maxVelocityY=.8,this._friction=.003}connectedCallback(){this._registerListeners(),this._ro=new ResizeObserver(this._resize),this._ro.observe(this.$viewport),this._ro.observe(this.$contentArea),this._resize()}disconnectedCallback(){this._removeListeners(),this._ro&&(this._ro.disconnect(),this._ro=null),this._cancelFrame()}panTo(t,e){let i=this._clampX(t),s=this._clampY(e);this._applyTransform(i,s),this._emitEvent("pan-update",{x:i,y:s})}_onPointerDown=t=>{!this._isLeftButtonEvent(t)||this._isValidPointerEvent(t)||(this._maybeDragging=!0,this._activePointerId=t.pointerId,this._suppressNextClick=!1,this._startClientX=t.clientX,this._startClientY=t.clientY,this._startX=this.currentX,this._startY=this.currentY,this._cancelFrame(),this._velocityX=0,this._velocityY=0,window.addEventListener("pointerup",this._onPointerUp),window.addEventListener("pointercancel",this._onPointerUp),window.addEventListener("pointermove",this._onPointerMove))};_onPointerUp=t=>{this._maybeDragging=!1,this._activePointerId=null,this.$viewport.releasePointerCapture?.(t.pointerId),window.removeEventListener("pointermove",this._onPointerMove),window.removeEventListener("pointerup",this._onPointerUp),window.removeEventListener("pointercancel",this._onPointerUp),this._dragging&&(this._dragging=!1,this._suppressNextClick=!0,this._frameRequested&&this._flushFrame(),this._emitEvent("pan-end",{x:this.currentX,y:this.currentY}),(Math.abs(this._velocityX)>0||Math.abs(this._velocityY)>0)&&this._startInertia())};_onPointerMove=t=>{if(this._isValidPointerEvent(t)){if(!this._dragging){if(!this._maybeDragging||!this._sufficientDistance(t))return;this._startDragging()}this._drag(t)}};_isLeftButtonEvent(t){return(1&t.buttons)==1}_isValidPointerEvent(t){return null!==this._activePointerId&&t.pointerId===this._activePointerId}_sufficientDistance(t){return Math.hypot(t.clientX-this._startClientX,t.clientY-this._startClientY)>=this._dragThreshold}_startDragging(){this.$viewport.setPointerCapture(this._activePointerId),this._maybeDragging=!1,this._dragging=!0,this._lastMoveTime=0,this._velocityX=0,this._velocityY=0,this._emitEvent("pan-start",{x:this.currentX,y:this.currentY})}_drag(t){t.preventDefault();let e=t.clientX-this._startClientX,i=t.clientY-this._startClientY,s=this._startX+e,n=this._startY+i;this._pendingX=this._clampX(s),this._pendingY=this._clampY(n),this._frameRequested||(this._frameRequested=!0,this._rafId=requestAnimationFrame(()=>this._flushFrame())),this._updateVelocity()}_flushFrame(){this._frameRequested=!1,this._applyTransform(this._pendingX,this._pendingY)}_cancelFrame(){cancelAnimationFrame(this._rafId),this._rafId=null,this._frameRequested=!1}_applyTransform(t,e){this.currentX=t,this.currentY=e,this.$contentArea.style.transform=`translate3d(${t}px, ${e}px, 0)`,this._emitEvent("pan-update",{x:t,y:e})}_updateVelocity(){let t=performance.now();if(0!==this._lastMoveTime){let e=t-this._lastMoveTime;e>0&&(this._velocityX=(this._pendingX-this._lastX)/e,this._velocityY=(this._pendingY-this._lastY)/e,this._velocityX=this._clampVelocityX(this._velocityX),this._velocityY=this._clampVelocityY(this._velocityY))}this._lastMoveTime=t,this._lastX=this._pendingX,this._lastY=this._pendingY}_startInertia(){if(this._cancelFrame(),0===this._velocityX&&0===this._velocityY)return;let t=performance.now(),e=i=>{let s=Math.min(i-t,50);if(t=i,s<=0){this._rafId=requestAnimationFrame(e);return}let n=Math.exp(-this._friction*s);this._velocityX*=n,this._velocityY*=n;let a=this.currentX+this._velocityX*s,r=this.currentY+this._velocityY*s,o=this._clampX(a),l=this._clampY(r);if(this._applyTransform(o,l),o!==a&&(this._velocityX=0),l!==r&&(this._velocityY=0),.03>=Math.abs(this._velocityX)&&.03>=Math.abs(this._velocityY)){this._velocityX=0,this._velocityY=0,this._rafId=null;return}this._rafId=requestAnimationFrame(e)};this._rafId=requestAnimationFrame(e)}_clampX(t){return Math.max(-this._maxX,Math.min(0,t))}_clampY(t){return Math.max(-this._maxY,Math.min(0,t))}_clampVelocityX(t){return Math.max(-this._maxVelocityX,Math.min(this._maxVelocityX,t))}_clampVelocityY(t){return Math.max(-this._maxVelocityY,Math.min(this._maxVelocityY,t))}_resize=()=>{let{vw:t,vh:e,cw:i,ch:s}=this._getDimensions();this._maxX=Math.max(0,i-t),this._maxY=Math.max(0,s-e);let n=this._clampX(this.currentX),a=this._clampY(this.currentY);(n!==this.currentX||a!==this.currentY)&&this._applyTransform(n,a)};_getDimensions(){let{clientWidth:t,clientHeight:e}=this.$viewport,{scrollWidth:i,scrollHeight:s}=this.$contentArea;return{vw:t||this.$viewport.getBoundingClientRect().width,vh:e||this.$viewport.getBoundingClientRect().height,cw:i||this.$contentArea.getBoundingClientRect().width,ch:s||this.$contentArea.getBoundingClientRect().height}}_onClickCapture=t=>{this._suppressNextClick&&(t.stopImmediatePropagation(),t.preventDefault(),this._suppressNextClick=!1)};_emitEvent(t,e={}){this.dispatchEvent(new CustomEvent(t,{detail:e,bubbles:!0,composed:!0}))}_registerListeners(){this.$viewport.addEventListener("pointerdown",this._onPointerDown),this.addEventListener("click",this._onClickCapture,!0)}_removeListeners(){this.$viewport.removeEventListener("pointerdown",this._onPointerDown),this.removeEventListener("click",this._onClickCapture,!0),window.removeEventListener("pointermove",this._onPointerMove),window.removeEventListener("pointerup",this._onPointerUp),window.removeEventListener("pointercancel",this._onPointerUp)}}customElements.get("pannable-container")||customElements.define("pannable-container",v);var w={};w="*{background-origin:padding-box;margin:0;padding:0}:host{background-color:#fff;border:1px solid #222;border-radius:3px;width:100%;height:8px;display:block;overflow:hidden}.bar{background-color:#00d41c;border-right:1px solid #222;width:0%;height:100%}";let y=document.createElement("template");y.innerHTML=`
  <style>${w}</style>

  <main id="bar" class="bar" part="bar"></main>
`;class _ extends HTMLElement{static get observedAttributes(){return["value","max"]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(y.content.cloneNode(!0)),this.$container=this.shadowRoot.querySelector("#container"),this.$bar=this.shadowRoot.querySelector("#bar")}connectedCallback(){this.setAttribute("role","progressbar"),this.setAttribute("aria-valuemin","0"),this.update()}attributeChangedCallback(){this.update()}update(){let t=Number(this.getAttribute("max")||100),e=Math.min(Number(this.getAttribute("value")||0),t),i=0===t?0:e/t*100;this.$bar.style.width=`${i}%`,this.setAttribute("aria-valuenow",e.toString()),this.setAttribute("aria-valuemax",t.toString())}}customElements.define("progress-bar",_);var x={};x="*{box-sizing:border-box;margin:0;padding:0}:host{display:block;position:relative}.snow-canvas{z-index:2;pointer-events:none;position:absolute;top:0;left:0}::slotted(*){z-index:1;position:relative}";let k=document.createElement("template");k.innerHTML=`
  <style>${x}</style>

  <canvas class="snow-canvas"></canvas>
  <slot></slot>
`;class C{static DEFAULT_CONFIG={radius:{min:1,range:4},opacity:{min:.9,range:.1},blur:{min:3,range:1},fallSpeed:{min:.1,range:.7},driftSpeed:{baseRange:.1,depthRange:1.8},driftPhaseIncrement:{base:.01,factor:.01}};constructor(t,e={}){this.$canvas=t,this.ctx=t.getContext("2d"),this.snowflakes=[],this.running=!1,this.animate=this.animate.bind(this),this.config={...C.DEFAULT_CONFIG,...e},this._lastTime=null}start(t){this.initSnowflakes(t),this.running||(this.running=!0,this._lastTime=null,this.animate())}stop(){this.running=!1}setConfig(t){this.config={...this.config,...t}}initSnowflakes(t){this.snowflakes=[];let e=this.config;for(let i=0;i<t;i++){let t=Math.random();this.snowflakes.push({depth:t,x:Math.random()*this.$canvas.width,y:Math.random()*this.$canvas.height,radius:e.radius.min+t*e.radius.range,opacity:e.opacity.min+t*e.opacity.range,blur:e.blur.min+t*e.blur.range,speed:e.fallSpeed.min+t*e.fallSpeed.range,xSpeed:(Math.random()-.5)*(e.driftSpeed.baseRange+t*e.driftSpeed.depthRange),xOffset:Math.random()*Math.PI*2})}}animate(t){if(!this.running)return;let e=t||performance.now(),i=(null===this._lastTime?0:e-this._lastTime)/(1e3/60);this._lastTime=e;let{ctx:s,$canvas:n}=this;for(let t of(s.clearRect(0,0,n.width,n.height),this.snowflakes))this.drawFlake(t),t.y+=t.speed*i,t.x+=t.xSpeed*Math.sin(t.xOffset)*i,t.xOffset+=(this.config.driftPhaseIncrement.base+t.depth*this.config.driftPhaseIncrement.factor)*i,t.y>n.height&&(t.y=-t.radius,t.x=Math.random()*n.width,t.xOffset=Math.random()*Math.PI*2);requestAnimationFrame(this.animate)}drawFlake({x:t,y:e,radius:i,opacity:s,blur:n}){let a=this.ctx;a.save(),a.globalAlpha=s,a.shadowBlur=n,a.shadowColor="#006b66ff",a.fillStyle="#ffffffff",a.beginPath(),a.arc(t,e,i,0,2*Math.PI),a.fill(),a.restore()}}class E extends HTMLElement{static get observedAttributes(){return["width","height"]}get width(){return this.getAttribute("width")||300}set width(t){this.setAttribute("width",t)}get height(){return this.getAttribute("height")||150}set height(t){this.setAttribute("height",t)}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(k.content.cloneNode(!0)),this.$canvas=this.shadowRoot.querySelector("canvas"),this.snowCanvas=new C(this.$canvas)}disconnectedCallback(){this.snowCanvas.stop()}attributeChangedCallback(t,e,i){"width"===t&&(this.style.width=`${i}px`,this.$canvas.width=Number(i)),"height"===t&&(this.style.height=`${i}px`,this.$canvas.height=Number(i))}startSnow(t){this.snowCanvas.start(t)}}customElements.define("snow-overlay",E);let $=new class{current=null;change(t){this.current&&this.current.exit(),this.current=t,this.current.enter()}},A=new class{constructor(){this.locked=!0,this.audioCtx=null,this.masterGain=null,this.arrayBuffers={},this.audioBuffers={},this.activeSources={sounds:{},tracks:{}},this.manualPause=!1}async init(){this.audioCtx||(this.audioCtx=new AudioContext,this.masterGain=this.audioCtx.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this.audioCtx.destination),"suspended"===this.audioCtx.state&&await this.audioCtx.resume(),await this.decodeBuffers(),this.locked=!1)}get isPaused(){return!this.audioCtx||"suspended"===this.audioCtx.state}async playSound(t,{volume:e}={}){return this._play(t,"sounds",{volume:e})}async playAmbienceTrack(t,{volume:e}={}){return this._play(t,"tracks",{volume:e,loop:!0})}async stopAmbienceTrack(t){this._stop(t,"tracks")}async _play(t,e,{volume:i=1,loop:s=!1}={}){return this.audioCtx?new Promise(n=>{let a=this.audioCtx.createBufferSource();a.buffer=this.audioBuffers[t],a.loop=s;let r=this.audioCtx.createGain();r.gain.value=Math.max(0,i),a.connect(r),r.connect(this.masterGain),a.start(0),this.activeSources[e][t]={source:a,gain:r},a.onended=()=>{delete this.activeSources[e][t],n()}}):console.warn("[AudioPlayer] audio context is locked")}_stop(t,e){if(!this.audioCtx)return console.warn("[AudioPlayer] audio context locked");let i=this.activeSources[e][t];i&&i.source.stop()}register(t,e){this.arrayBuffers[t]=e}async pause(t=!1){if(!this.audioCtx)return console.warn("[AudioPlayer] cannot pause: audio context locked");"suspended"!==this.audioCtx.state&&(await this.audioCtx.suspend(),t&&(this.manualPause=!0))}async resume(t=!1){if(!this.audioCtx)return console.warn("[AudioPlayer] cannot resume: audio context locked");"running"===this.audioCtx.state&&await this.audioCtx.resume(),(!this.manualPause||t)&&(this.clearSources("sounds"),this.manualPause=!1,await this.audioCtx.resume())}clearSources(t){Object.keys(this.activeSources[t]).forEach(e=>{this._stop(e,t)})}async decodeBuffers(){if(!this.audioCtx)return console.warn("[AudioPlayer] cannot decode: audio context locked");"running"!==this.audioCtx.state&&await this.audioCtx.resume();try{await Promise.all(Object.entries(this.arrayBuffers).map(async([t,e])=>{let i=e.slice(0),s=await this.audioCtx.decodeAudioData(i);this.audioBuffers[t]=s}))}catch(t){return`Error during audio decoding: ${t.message}`}this.arrayBuffers={}}},L="stage-calendar-assets",P="stage-package-thumbnails",M="stage-complete",S=new class{loadingStage="stage-initial";progress=0;progressCallbacks=[];cachedImages={};cachedAudioBuffers={};audioInfo={};_assetMapping=null;get assetMapping(){if(!this._assetMapping)throw Error("Asset mapping not loaded yet");return Object.freeze(this._assetMapping)}get calendarAssetsReady(){return[P,M].includes(this.loadingStage)}get packageThumbnailsReady(){return this.loadingStage===M}async run(){await this.loadAssetMapping(),await this.preloadCalendarAssets(),await this.preloadPackageThumbnails(),this.loadingStage=M}registerProgressCallback(t,e){e(this.loadingStage,this.progress),this.progressCallbacks.push({key:t,cb:e})}unregisterProgressCallback(t){this.progressCallbacks=this.progressCallbacks.filter(e=>e.key!==t)}async preloadCalendarAssets(){this.loadingStage=L;let t=[this._assetMapping.background.filename,...this._assetMapping.doors.map(t=>t.filename),...this._assetMapping.ui,...this._assetMapping.animations.flatMap(({filenames:t})=>t),...this.doorNumbers()],e=this._assetMapping.audio,i=t.length+e.length,s=0;await this.preloadImages(t,()=>{s++,this.onProgress(s,i)}),await Promise.all(e.map(async({name:t,filename:e,volume:n})=>{let a=await this.loadAudio(`audio/${e}`);A.register(t,a),s++,this.audioInfo[t]={volume:n},this.onProgress(s,i)}))}doorNumbers(){let t=[];for(let e=1;e<=24;e++)t.push(`door-numbers/${e.toString()}.webp`);return t}onProgress(t,e){let i=0===e?0:Math.floor(t/e*100);this.progress=i,this.progressCallbacks.forEach(({cb:t})=>t(this.loadingStage,i,100===i))}getImage(t){let e=this.cachedImages[t];if(!e)throw Error(`[AssetLoader] image not cached: ${t}`);return e}async preloadPackageThumbnails(){this.loadingStage=P;let t=this._assetMapping.doors.map(({packageId:t})=>this._assetMapping.packages[t]?.thumbnail);await S.preloadImages(t,(t,e)=>{let i=0===e?0:Math.floor(t/e*100);this.progress=i,this.progressCallbacks.forEach(({cb:t})=>t(this.loadingStage,i,100===i))})}async preloadImages(t,e){let i=t.length,s=0,n=t.map(t=>this.preloadImage(`images/${t}`).then(n=>(this.cachedImages[t]=n,s++,e&&e(s,i),n)));await Promise.all(n)}async preloadImage(t){return new Promise((e,i)=>{let s=new Image;s.onload=()=>e(s),s.onerror=()=>i(Error(`[AssetLoader] failed to load image: ${t}`)),s.src=t})}async loadAudio(t){let e=await fetch(t);return await e.arrayBuffer()}async loadAssetMapping(){let t=await fetch("assets.json");this._assetMapping=await t.json()}async refreshImage(t){let e=this.cachedImages[t];if(!e)throw Error(`[AssetLoader] image not cached: ${t}`);try{await e.decode()}catch{}}},T=new class{$app=null;$animations=[];constructor(){this.$app=this.selectElement("#app")}revealCalendar(){this.selectElement("#title-screen").remove()}async renderCalendarAssets(){let t=S.assetMapping,e=this.selectElement("#snow-overlay"),i=T.selectElement("#calendar");await this.renderBackground(e,i,t),this.renderDoors(i,t),this.renderAnimations(i,t)}async renderBackground(t,e,{background:i}){await S.refreshImage(i.filename),t.setAttribute("width",i.width),t.setAttribute("height",i.height),e.style.backgroundImage=`url('images/${i.filename}')`,e.style.width=`${i.width}px`,e.style.height=`${i.height}px`}startSnow(t){this.selectElement("#snow-overlay").startSnow(t)}renderDoors(t,{doors:e}){t.innerHTML="",e.forEach(e=>t.appendChild(this.buildDoorElement(e)))}renderAnimations(t,{animations:e}){e.forEach(e=>{let i=document.createElement("animation-sequence");i.config={...e,images:e.filenames.map(t=>S.getImage(t))},t.appendChild(i),this.$animations.push(i)})}updateAnimations(t){this.$animations.forEach(e=>{e.onTick(t)})}reopenDoors(t={}){Object.keys(t).forEach(t=>{this.selectElement(`#${t}`).open()})}buildDoorElement(t){let e=document.createElement("calendar-door");return e.config=t,e}handleForbiddenDoor(t){t.shake(),this.playSound("forbidden")}async playSound(t){A.isPaused||await A.playSound(t,{volume:S.audioInfo[t]?.volume||1})}playAmbience(){A.playAmbienceTrack("wind")}stopAmbience(){A.stopAmbienceTrack("wind")}updateProgressBar(t,e,i=2){t.setAttribute("value",Math.max(e,i))}configurePackages(){S.assetMapping.doors.forEach(t=>{T.selectElement(`#${t.id}`).packageConfig=S.assetMapping.packages[t.packageId]})}enterFullscreen(){document.fullscreenElement||this.$app.requestFullscreen()}exitFullscreen(){document.fullscreenElement&&document.exitFullscreen()}selectElement(t){let e=document.querySelector(t);if(!e)throw Error(`UI element not found: ${t}`);return e}},I="opened-doors",X=new class{dt=0;counter=0;maxCounter=8;cutoff=2/8*1e3;prevTime=0;ref=0;run=t=>{this.prevTime>0&&(this.dt+=t-this.prevTime,this.dt>=this.cutoff&&(this.dt%=this.cutoff,this.counter=(this.counter+1)%this.maxCounter,this.tick())),this.prevTime=t,this.ref=requestAnimationFrame(this.run)};tick(){document.dispatchEvent(new CustomEvent("tick",{detail:{i:this.counter}}))}};class Y{key="calendar-context";openedDoors={};$calendar=null;async enter(){this.openedDoors=function(){let t=localStorage.getItem(I);if(!t)return{};try{return JSON.parse(t)}catch{return{}}}(),await this.render(),this.player=T.selectElement("#media-player"),this.$panningContainer=T.selectElement("#calendar-panner"),this.$calendar=T.selectElement("#calendar"),await this.setStartPosition(-1200,-250),this.registerListeners(),this.prepareContentPackages(),this.startAnimationTimer(),T.revealCalendar()}exit(){this.removeListeners()}async render(){await T.renderCalendarAssets(),T.reopenDoors(this.openedDoors),T.startSnow(400),await A.decodeBuffers(),T.playAmbience()}onCalendarClick=t=>{let e=t.target.closest("[data-door]");if(e)return t.preventDefault(),this.onDoorClick(e);let i=t.target.closest("[data-content]");i&&i.displayContent()};onDoorClick(t){let e;if(!t.mayOpen())return T.handleForbiddenDoor(t);this.openedDoors[t.id]=!0,e=JSON.stringify(this.openedDoors),localStorage.setItem(I,e),t.open(),T.playSound("door")}onShowPlayer=t=>{T.stopAmbience(),this.player.displayImage(t)};onPlayerClosed=()=>{T.playAmbience()};onAudioMute=async()=>{await T.playSound("click"),A.pause(!0)};onAudioUnmute=()=>{T.playSound("click"),A.resume(!0)};onEnterFullscreen=()=>{T.enterFullscreen()};onExitFullscreen=()=>{T.exitFullscreen()};onVisibilityChange=()=>{document.hidden?A.pause():A.resume()};onTick=t=>{T.updateAnimations(t.detail.i)};onKeyDown=t=>{"Space"===t.code&&t.preventDefault()};prepareContentPackages(){S.packageThumbnailsReady?T.configurePackages():S.registerProgressCallback(this.key,this.onLoadingProgress)}onLoadingProgress=(t,e,i)=>{t!==P||i&&(S.unregisterProgressCallback(this.key),T.configurePackages())};startAnimationTimer(){X.run()}async setStartPosition(t,e){setTimeout(()=>{this.$panningContainer.panTo(t,e)},0)}registerListeners(){this.$calendar.addEventListener("click",this.onCalendarClick),document.addEventListener("show-player",this.onShowPlayer),document.addEventListener("player-closed",this.onPlayerClosed),document.addEventListener("audio-mute",this.onAudioMute),document.addEventListener("audio-unmute",this.onAudioUnmute),document.addEventListener("enter-fullscreen",this.onEnterFullscreen),document.addEventListener("exit-fullscreen",this.onExitFullscreen),document.addEventListener("visibilitychange",this.onVisibilityChange),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("tick",this.onTick)}removeListeners(){this.$calendar.removeEventListener("click",this.onCalendarClick),document.removeEventListener("show-player",this.onShowPlayer),document.removeEventListener("player-closed",this.onPlayerClosed),document.removeEventListener("audio-mute",this.onAudioMute),document.removeEventListener("audio-unmute",this.onAudioUnmute),document.removeEventListener("enter-fullscreen",this.onEnterFullscreen),document.removeEventListener("exit-fullscreen",this.onExitFullscreen),document.removeEventListener("visibilitychange",this.onVisibilityChange),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("tick",this.onTick)}}class F{key="title-context";loadingProgress=0;autoSwitch=!1;$startBtn=null;$progressBar=null;enter(){this.$startBtn=T.selectElement("#start-button"),this.$progressBar=T.selectElement("#progress-bar"),S.registerProgressCallback(this.key,this.onLoadingProgress),S.run(),this.registerListeners()}exit(){this.removeListeners()}onLoadingProgress=(t,e,i)=>{t!==L||(this.loadingProgress=e,!this.autoSwitch||(this.updateProgressBar(),i&&(S.unregisterProgressCallback(this.key),setTimeout(this.goToCalendar,1200))))};onStartClick=()=>{S.calendarAssetsReady?this.goToCalendar():this.waitForPreload()};waitForPreload=()=>{this.$startBtn.classList.add("hide"),this.$progressBar.classList.remove("hide"),this.autoSwitch=!0,setTimeout(this.updateProgressBar,0)};goToCalendar=()=>{$.change(new Y)};updateProgressBar=()=>{T.updateProgressBar(this.$progressBar,this.loadingProgress)};registerListeners(){this.$startBtn.addEventListener("click",this.onStartClick)}removeListeners(){this.$startBtn.removeEventListener("click",this.onStartClick)}}document.addEventListener("DOMContentLoaded",()=>{"#reset"===location.hash&&localStorage.clear(),$.change(new F)},{once:!0});let D=()=>{A.init(),document.removeEventListener("click",D)};document.addEventListener("click",D);
//# sourceMappingURL=adventadventure.e4147dff.js.map
